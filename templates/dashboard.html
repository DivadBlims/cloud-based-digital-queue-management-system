{% extends "base.html" %}

{% block title %}Dashboard - BlimSphere Cloud{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h2>My Files</h2>
</div>

<!-- Storage Usage Card -->
<div class="storage-card">
    <h3>Storage Usage</h3>
    <div class="storage-info">
        <div class="storage-bar-container">
            <div class="storage-bar" id="storageBar" style="width: {{ usage_percent }}%" data-used="{{ used_gb }}" data-limit="{{ limit_gb }}"></div>
        </div>
        <div class="storage-stats">
            <div class="storage-stat">
                <span class="storage-stat-value" id="usedStorage">{{ "%.6f"|format(used_gb) }}</span>
                <span class="storage-stat-label">Used</span>
            </div>
            <div class="storage-stat">
                <span class="storage-stat-value" id="remainingStorage" data-remaining="{{ remaining_gb }}">{{ "%.6f"|format(remaining_gb) }}</span>
                <span class="storage-stat-label">Remaining</span>
            </div>
            <div class="storage-stat">
                <span class="storage-stat-value" id="totalStorage">{{ "%.2f"|format(limit_gb) }}</span>
                <span class="storage-stat-label">Total</span>
            </div>
        </div>
        {% if remaining_gb <= 0 %}
        <div class="storage-warning">
            <span>‚ö†Ô∏è</span>
            <span>Storage quota exceeded. Please delete files to upload new ones.</span>
        </div>
        {% endif %}
    </div>
</div>

<!-- Upload Section -->
<div class="upload-section">
    <h3>Upload File</h3>
    <form method="POST" action="{{ url_for('upload_file') }}" enctype="multipart/form-data" class="upload-form" id="uploadForm">
        <div class="file-input-wrapper">
            <input type="file" id="file" name="file" required>
        </div>
        
        <!-- File Info Display -->
        <div class="file-info" id="fileInfo">
            <div class="file-info-item">
                <span class="file-info-label">File Size:</span>
                <span class="file-info-value" id="fileSize">-</span>
            </div>
            <div class="file-info-item">
                <span class="file-info-label">Remaining Storage After Upload:</span>
                <span class="file-info-value" id="remainingAfterUpload">{{ "%.4f"|format(remaining_gb) }} GB</span>
            </div>
        </div>
        
        <!-- Upload Progress -->
        <div class="upload-progress-container" id="uploadProgress">
            <div class="upload-progress-bar">
                <div class="upload-progress-fill" id="uploadProgressBar" style="width: 0%"></div>
            </div>
            <div class="upload-progress-text" id="uploadProgressText">Preparing upload...</div>
        </div>
        
        <!-- Upload Success Message -->
        <div class="upload-success" id="uploadSuccess">
            <span>‚úÖ</span>
            <span>File uploaded successfully! Storage updated.</span>
        </div>
        
        <button type="submit" class="btn btn-primary btn-block" {% if remaining_gb <= 0 %}disabled{% endif %}>
            <span>üì§</span>
            <span>Upload File</span>
        </button>
    </form>
</div>

<!-- Files List -->
<div class="files-section">
    <h3>Your Files ({{ files|length }})</h3>
    {% if files %}
        <table class="files-table">
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Size</th>
                    <th>Uploaded</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                <tr>
                    <td class="filename">{{ file.filename }}</td>
                    <td>
                        <strong>{{ "%.2f"|format(file.get_size_mb()) }} MB</strong><br>
                        <small style="color: #64748b;">({{ "%.4f"|format(file.get_size_gb()) }} GB)</small>
                    </td>
                    <td>{{ file.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td class="actions">
                        <a href="{{ url_for('download_file', file_id=file.file_id) }}" class="btn btn-sm btn-primary">‚¨áÔ∏è Download</a>
                        <form method="POST" action="{{ url_for('delete_file', file_id=file.file_id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this file?');">
                            <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="empty-state">No files uploaded yet. Upload your first file above!</p>
    {% endif %}
</div>
{% endblock %}

