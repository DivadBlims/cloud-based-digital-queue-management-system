{% extends "base.html" %}

{% block title %}Admin Portal - BlimSphere Cloud{% endblock %}

{% block content %}
<div class="admin-header">
    <h2>Admin Portal</h2>
</div>

<!-- System Statistics -->
<div class="stats-grid">
    <div class="stat-card">
        <h3>System Overview</h3>
        <div class="stat-item">
            <span class="stat-label">Total Nodes:</span>
            <span class="stat-value">{{ stats.total_nodes }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Total Users:</span>
            <span class="stat-value">{{ total_users }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Total Files:</span>
            <span class="stat-value">{{ total_files }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Storage Utilization:</span>
            <span class="stat-value">{{ "%.2f"|format(stats.storage_utilization) }}%</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Bandwidth Utilization:</span>
            <span class="stat-value">{{ "%.2f"|format(stats.bandwidth_utilization) }}%</span>
        </div>
    </div>
</div>

<!-- Add New Node -->
<div class="admin-section">
    <h3>Add New Node</h3>
    <form method="POST" action="{{ url_for('add_node') }}" class="admin-form">
        <div class="form-row">
            <div class="form-group">
                <label for="node_id">Node ID</label>
                <input type="text" id="node_id" name="node_id" required>
            </div>
            <div class="form-group">
                <label for="cpu_capacity">CPU (vCPUs)</label>
                <input type="number" id="cpu_capacity" name="cpu_capacity" min="1" value="4" required>
            </div>
            <div class="form-group">
                <label for="memory_capacity">Memory (GB)</label>
                <input type="number" id="memory_capacity" name="memory_capacity" min="1" value="16" required>
            </div>
            <div class="form-group">
                <label for="storage_capacity">Storage (GB)</label>
                <input type="number" id="storage_capacity" name="storage_capacity" min="1" value="500" required>
            </div>
            <div class="form-group">
                <label for="bandwidth">Bandwidth (Mbps)</label>
                <input type="number" id="bandwidth" name="bandwidth" min="1" value="1000" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Add Node</button>
    </form>
</div>

<!-- Extend Node Capacity -->
<div class="admin-section">
    <h3>Extend Node Storage</h3>
    <form method="POST" action="{{ url_for('extend_node') }}" class="admin-form">
        <div class="form-row">
            <div class="form-group">
                <label for="extend_node_id">Select Node</label>
                <select id="extend_node_id" name="node_id" required>
                    {% for node in nodes %}
                    <option value="{{ node.id }}">{{ node.id }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="additional_storage">Additional Storage (GB)</label>
                <input type="number" id="additional_storage" name="additional_storage" min="1" value="100" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Extend Storage</button>
    </form>
</div>

<!-- Nodes List -->
<div class="admin-section">
    <h3>Storage Nodes</h3>
    {% if nodes %}
        <table class="nodes-table">
            <thead>
                <tr>
                    <th>Node ID</th>
                    <th>CPU</th>
                    <th>Memory</th>
                    <th>Storage Total</th>
                    <th>Storage Used</th>
                    <th>Storage Utilization</th>
                    <th>Bandwidth</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for node in nodes %}
                <tr>
                    <td><strong>{{ node.id }}</strong></td>
                    <td>{{ node.cpu }} vCPUs</td>
                    <td>{{ node.memory }} GB</td>
                    <td>{{ "%.2f"|format(node.storage_total_gb) }} GB</td>
                    <td>{{ "%.2f"|format(node.storage_used_gb) }} GB</td>
                    <td>
                        <div class="util-bar">
                            <div class="util-bar-fill" style="--util-width: {{ node.storage_util_percent|float }}%"></div>
                            <span>{{ "%.1f"|format(node.storage_util_percent) }}%</span>
                        </div>
                    </td>
                    <td>{{ node.bandwidth_mbps }} Mbps</td>
                    <td>
                        <form method="POST" action="{{ url_for('delete_node') }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete node {{ node.id }}? This action cannot be undone!');">
                            <input type="hidden" name="node_id" value="{{ node.id }}">
                            <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="empty-state">No nodes configured. Add a node above.</p>
    {% endif %}
</div>
{% endblock %}

